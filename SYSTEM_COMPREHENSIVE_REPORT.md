# التقرير الشامل لهيكلية نظام ICGL (دليل النظام)

بناءً على التحليل الفني العميق لمستودع الكود (Codebase) والوثائق التقنية، نلخص أدناه البنية التحتية والمكونات الأساسية للنظام:

---

## 1. واجهات المستخدم (19 واجهة)

يتكون النظام من 19 واجهة وظيفية موزعة على ثلاث بيئات رئيسية:

### أ) تطبيق الويب الرئيسي React (`web`)

*(يمكن الوصول إليها عبر: [http://localhost:8080/app/](http://localhost:8080/app/))*

1. **قمرة القيادة (System Cockpit)**: لوحة التحكم المركزية.
2. **تفاصيل الوكلاء (Agent Details)**: عرض حالة كل وكيل.
3. **منصة المحادثة (Chat Interface)**: التفاعل المباشر مع النظام.
4. **إدارة القدرات (Capabilities)**: التحكم في وظائف الوكلاء.
5. **منفذ الأفكار (Idea Runner)**: سير عمل معالجة المقترحات.
6. **الخريطة الذهنية (Mind Map)**: تصور المفاهيم.
7. **الجدول الزمني (Timeline)**: سجل الأحداث والقرارات.
8. **الأمن (Security)**: إعدادات حماية النظام.
9. **العمليات (Operations)**: إدارة المهام الخلفية.
10. **خارطة الطريق (Roadmap)**: الأهداف المستقبلية.
11. **مخطط العقل الموسع (Extended Mind Graph)**: تصور الروابط المعقدة.
12. **سير عمل الوكلاء (Agents Flow)**: تنسيق التفاعل بين الوكلاء.

### ب) بوابة الإدارة (Admin Portal)

*(يمكن الوصول إليها عبر: [http://localhost:8000/admin/](http://localhost:8000/admin/))*

1. **دردشة الإدارة (Admin Chat)**.
2. **لوحة الإحصائيات (Dashboard)**.
3. **الأمن والامتثال (SCP)**.
4. **المراقبة (Observability)**.

### ج) الواجهات الثابتة ووثائق الـ API

1. **صفحة الهبوط الرئيسية**: [http://localhost:8000/](http://localhost:8000/)
2. **وثائق الـ API (Swagger)**: [http://localhost:8000/docs](http://localhost:8000/docs)
3. **الواجهات التجريبية (UI)**: [http://localhost:8000/ui/](http://localhost:8000/ui/)

---

## 2. قواعد البيانات (5 قواعد بيانات)

يعتمد النظام على هيكلية تخزين هجينة (Hybrid Storage):

* **LanceDB**: قاعدة بيانات متجهة (Vector DB) للذاكرة الدلالية طويلة الأمد.
* **Qdrant**: خدمة اختيارية للذاكرة المتجهة والبحث المتقدم.
* **Knowledge Base (kb.db)**: مستودع المعرفة الهيكلية (SQLite).
* **Extended Mind (extended_mind.db)**: لتخزين العلاقات المعرفية المعقدة (SQLite).
* **Sessions (sessions.db)**: لإدارة جلسات المستخدم وتاريخ التفاعل (SQLite).

---

## 3. الوكلاء والأدوار الذكية (33 دوراً)

تنقسم منظومة الوكلاء إلى أربع فئات رئيسية:

* **الوكلاء النشطون برمجياً (16)**: تشمل وكلاء التحليل (Architect, Failure, Sentinel)، البناء (Builder, Engineer)، ووكلاء متخصصين في الواجهة (Performance, Structural).
* **الأدوار التشغيلية (5)**: (مدير الوكلاء HRAgent، سجل التسجيل Registry، فاحص القدرات، مدير الحوار، ومحلل النوايا).
* **وكلاء الرؤية المستقبلية (11)**: (مثل الأرشيف Archivist، الأمان المتقدم، المدقق اللغوي للكود، وفريق الدفاع Red Team).
* **السيادة (1)**: (الإنسان صاحب القرار النهائي - المالك).

---

## 4. الخوادم البرمجية والمنافذ (Servers & Ports)

بناءً على سكربت التشغيل `dev_launcher.ps1` وبنية النظام الحالية:

* **خادم الباك اند (Backend API)**: يعمل على المنفذ `8000` (`uvicorn api.server:app`).
* **خادم الفرونت اند (Frontend Vite)**: يعمل على المنفذ `8080` (`npm run dev`) ويمكن الوصول إليه عبر `http://localhost:8080/app/`.
* **إدارة المنافذ (Cleanup)**: يقوم السكربت بتنظيف المنافذ `8000` و `8080` و `5173` عند البدء لضمان عدم حدوث تعارض.
* **الخدمات الإضافية**: يتم تشغيل **Qdrant** اختيارياً عبر Docker-compose.
* **البوابات الأخرى**: تتوفر بوابة `simple_ui_server.py` للربط الشامل ولكن الاعتماد في التشغيل السريع يكون على المنافذ المذكورة أعلاه.

## 5. واجهات البرمجة (API Endpoints - 45+ نقطة)

تم حصر أكثر من **45 نقطة اتصال (Endpoint)** موزعة حسب الوظائف التالية:

### أ) الحوكمة والقرارات (Core Governance)

* `POST /propose`: تقديم مقترح قرار جديد.
* `POST /idea-run`: تشغيل فكرة سريعة وتحويلها لقرار.
* `GET /api/idea-summary`: ملخص حالة القرار.
* `POST /api/quick/code`: تنفيذ كود مباشر (تجاوز الحوكمة للحالات الطارئة).

### ب) المحادثة والذكاء الاصطناعي (Conversational AI)

* `POST /chat`: واجهة المحادثة الرئيسية مع الوكلاء.
* `POST /coc/chat`: واجهة المحادثة المستمرة (Contextual).
* `POST /coc/sessions`: إدارة جلسات الحوار.

### ج) المراقبة والتحليل (Observability & ML)

* `GET /observability/traces`: تتبع مسار تنفيذ الأوامر.
* `GET /ml/anomalies`: كشف الشذوذ باستخدام تعلم الآلة.
* `POST /patterns/detect`: تحليل الأنماط في الوقت الحقيقي.

### د) إدارة الوكلاء والقنوات (Management)

* `GET /api/agents/list`: قائمة الوكلاء وقدراتهم.
* `GET /channels`: إدارة قنوات الاتصال بين الوكلاء.
* `GET /policies`: مراجعة سياسات الحوكمة النشطة.

### هـ) نظام الملفات والمعرفة (System & KB)

* `GET /system/docs/tree`: تصفح شجرة الوثائق المعرفية.
* `POST /system/docs/save`: تحديث وحفظ الوثائق يدوياً.

---
> [!IMPORTANT]
> تم تصميم هذه المنظومة لتعمل بشكل متكامل، حيث يراقب الوكلاء النظام، ويقترحون التغييرات، بينما تبقى السيادة التنفيذية المطلقة في يد المالك البشري.
