# ICGL Restructure Plan (Detailed)

## Goals
- ุชุณุทูุญ ุงููุณุงุฑุงุช ูุชูููู ุงูุชุดุงุจู ูุน ุฃุณูุงุก ูุงุถุญุฉ ุชุนุจูุฑ ุนู ุงูุบุฑุถ.
- ุถุจุท ุงูุฌูุฏุฉ ูุจูุฑูุง (lint/CI/ADR) ูุชูููู ุงููุฎุงุทุฑ ุฃุซูุงุก ุงูููู.
- ูุตู ุงูุฏููููุงุช ูู ูุญุฏุงุช ูุงุถุญุฉุ ูุชุญูฬูู ุงูู shared ุฅูู ุญุฒู versioned.
- ุชูุญูุฏ ุชุดุบูู ุงููุงุฌูุงุช ูุฎุงุฏู ุงูู proxyุ ูุชุจุณูุท ุงููAPI ูุงูุนููุฏ.

## ูุฑุงุญู ุงูุชูููุฐ

### ุงููุฑุญูุฉ 0 โ ุณูุงูุฉ ูุชุซุจูุช ุจูุงุจุงุช ุงูุฌูุฏุฉ (ููุฌุฒุฉ ุฌุฒุฆูุงู)
- โ pre-commit (ruff, ruff-format, black, isort, prettier, hygiene).
- โ CI ููุณูู: Python lint/test + Node lint/build (Python 3.14).
- ๐ ูุณุฎ ุงุญุชูุงุทู ูุจู ูู ููุฌุฉ ููู (ูุฌูุฏ `backups/`).

### ุงููุฑุญูุฉ 1 โ ูุชุงููุฌ ูุฎุฑูุทุฉ ูุนูุงุฑูุฉ
- ุฅุฎุฑุงุฌ/ุชุญุฏูุซ:
- `docs/service-catalog.md` (ุฎุฏูุงุชุ ูููุงุกุ ููุงุนุฏ ุจูุงูุงุชุ ููุงูุฐุ ุฃูุงูุฑ ุชุดุบูู).
- `docs/runbook.md` (ุฃูุงูุฑ dev/test/build ูุชุดุบูู ุงูุณูุฑูุฑุงุช).
- `docs/architecture-c4/` (Context, Container, Component) โ ูููุงุช ูุฎุฑุฌุงุช ูุงุญูุงู.
- ุฅุฏุฑุงุฌ ุฌุฏูู ููุงุนุฏ ุงูุจูุงูุงุช ูุงููports ุงููุงุถุญุฉ (API ุนูู 8000ุ UI gateway ุนูู 8080).

### ุงููุฑุญูุฉ 2 โ ุชูุญูุฏ ุงููุงุฌูุงุช ูุฅุฒุงูุฉ src
- โ ููู ูุดุฑูุน ุงููุงุฌูุฉ ุฅูู `ui/web/` ูุชุญุฏูุซ ุงููุณุงุฑุงุช (config/path_map, CI, docsุ simple_ui_server ูุฎุฏู `ui/web/dist`).
- โ ููู ูุญุชูู `ui/web/src` ุฅูู `ui/web/app`, ุชุญุฏูุซ `index.html` ููุดูุฑ ุฅูู `/app/main.tsx`, ูุชุนุฏูู `tsconfig.app.json` ุฅูู `app`.
- โ ุฅูุดุงุก `ui-gateway/` ูููู ุงูุฎุงุฏู ุฅููู (ูุงู `api/simple_ui_server.py`)ุ ูุน ุชูุซูู ุฃูุงูุฑ ุงูุชุดุบูู.
- โ ุชุญุฏูุซ Tailwind content ููุทุงุจู `ui/web/app`.
- Workspaces ูู `ui/package.json`ุ ูุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู `ui/packages/ui-components/`.
- ููู/ุฅูุบุงุก `src/components/TechnicalCapabilities.tsx` ุฅูู `ui/web/components/` ุฃู `ui/packages/ui-components/` ูุชุญุฏูุซ ุงูุงุณุชูุฑุงุฏุงุช. (ูุงุฏู)

### ุงููุฑุญูุฉ 3 โ ุชุฑุชูุจ ุงููAPI
- ุฅุจูุงุก FastAPI ูู `api/` ููุท: `api/routers/`, `api/schemas/`, `api/services/`, `api/settings.py`, `api/main.py`.
- ุฅุฎุฑุงุฌ ุงูููุทู ุบูุฑ ุงูุชูุฌููู ุฅูู ูุญุฏุงุช ุงูุฏูููู (ุงููุฑุญูุฉ 4).
- ุฅุถุงูุฉ Runbook ุชุดุบูู ูุญุฏูุซ ูููAPI ูุชููุฆุฉ ุงูุจูุฆุฉ.

### ุงููุฑุญูุฉ 4 โ ุชูููู ุงูุฏููููุงุช (Pilot ุซู ุชุนููู)
- โ ุฅูุดุงุก `modules/` ูุน ูุงุฌูุงุช ุงูุชูุงููุฉ (`modules/agents`, `modules/governance`, `modules/observability`, `modules/memory`, `modules/knowledge_base`, `modules/hr`) ุชุนูุฏ ุชุตุฏูุฑ ุงููbackend ุงูุญุงูู ูุถูุงู ุงุณุชูุฑุงุฑ ุงููุงุฑุฏุงุช ุฃุซูุงุก ุงูููู.
- ููู ุฏูููู: `core.py`, `service.py`, `storage.py`, `schemas.py`, `tests/`. (ูุงุฏู)
- ุทููุงุฑ: ููู ูุนูู ูู `backend/agents/*` ุฅูู `modules/agents/` ูุน ุชุญุฏูุซ ุงูุงุณุชูุฑุงุฏุงุช ูADR ูุฑุงููุ ุซู ุชุนููู ุนูู ุฏูููู ุซุงูู (ูุซูุงู observability). (ูุงุฏู)
- โ ุชุญุฏูุซ ุงุณุชูุฑุงุฏุงุช ุงููAPI ุฅูู `modules.observability` ู`modules.governance` ุจุฏู `backend.*` (router/server/shared).
- โ ุฅุนุงุฏุฉ ุชูุฌูู ุงูุงุณุชูุฑุงุฏุงุช ุงููุชุจููุฉ ููุฏููููุงุช (kb, memory, policies, hdal) ุฅูู `modules.*` ูุน ุฅุจูุงุก shims ุงูุชูุงููุฉ ูุญูุงูุฉ ุงูุชูุงูู.
- โ ุฌุนู `modules.{kb,memory,policies,hdal}` ูู ุงููุตุฏุฑ ุงููุงููููุ ูุชุฑู `backend/*` ุดููุงุช ุฑููุนุฉุ ุซู ุญุฐู ุงููุณุฎ ุงููุฒุฏูุฌุฉ.
- โ ุชุนููู ุงูููู ููุดูู `core`, `utils`, `git`, `llm`, `sentinel` ูุฌุนููุง ูุงููููุฉ ุชุญุช `modules/` ูุน ุฅุฒุงูุฉ ุญุฒู backend ุงูููุงุจูุฉ.

### ุงููุฑุญูุฉ 5 โ ุชุญููู shared ุฅูู ุญุฒู ูุงุถุญุฉ
- โ ุฅูุดุงุก ููุงูู ุฃูููุฉ ูู `libs/python/{knowledge_base,observability,memory,agents_core}` ู `libs/js/ui-components` ูุน README ุชูุถุญ ูุญุชูู ุงูููู ุงููุณุชูุฏู.
- โ ุฅุถุงูุฉ `pyproject.toml` ูุดูููุงุช ุงุณุชูุฑุงุฏ ููู ุญุฒูุฉ Python (agents_core โ modules.agentsุ knowledge_base โ modules.kbุ memory โ modules.memoryุ observability โ modules.observability).
- โ ุชุฌููุฒ ุญุฒูุฉ `libs/js/ui-components` ุจูููุงุช `package.json`, `tsconfig.json`, ู`src/index.ts` placeholder ูุน peer deps ูู React.
- โ ุฑุจุท ุงูุญุฒู ุจูCI: ุจูุงุก/ุชุซุจูุช ุณุฑูุน ูุญุฒู Python ูู GitHub Actionsุ ูุชุดุบูู lint/build ูุญุฒูุฉ `ui-components`.
- โ ุจุฏุก ููู ุงูููููุงุช: ููู `Mermaid`, `TechnicalCapabilities`, `WorkspaceSelector`, `TaskTracker`, `SovereignTerminal`, `CouncilGrid`, `ADRFeed`, `MetricsGrid`, `PolicyEditor` (+CSS), `TraceVisualization` (+CSS)ุ ูููููุงุช ุงููุญุงุฏุซุฉ (`MessageBubble`, `ThinkingBlock`, `ChatConsole`) ุฅูู `@icgl/ui-components` ูุน ุญุงููุงุช ุจูุงูุงุช/ุชุบููู ูู ุงููุงุฌูุฉ.
- โ ุชูุนูู lint ููุญุฒูุฉ ุงููุดุชุฑูุฉ: `npm run lint` ุงูุขู ูููู ุจู `tsc --noEmit` ููุนูู ูู CIุ ูุน `npm test` ูุญูู ููููุช.
- ุงูุชุงูู: ุชุญุฏูุฏ ุฎุทุฉ ุงูุฅุตุฏุงุฑ/ุงููุดุฑ ููู ุญุฒูุฉ ุจุนุฏ ููู ุงูููุฏ ุงููุนููุ ูุฑุจุทูุง ุจุงููworkspace/registry ุงูุฏุงุฎูู.

### ุงููุฑุญูุฉ 6 โ ุงูุนููุฏ (API + Events)
- โ ุชููุฆุฉ ูุฌูุฏ ุงูุนููุฏ: `contracts/api/README.md` ูุชูููุฏ `openapi.json` ูู FastAPIุ ู`contracts/events/README.md` ูุจุฏุงูุฉ ููุฎุทุทุงุช ุงูุฃุญุฏุงุซ.
- ุงุณุชุฎุฑุงุฌ Schemas ุฅูู `api/schemas/` ุฃู ุนููุฏ ูุฑูุฒูุฉ (`contracts/api/openapi.json`).
- `contracts/events/` ููุฃุญุฏุงุซ ูุน ุณุฌู ุฅุตุฏุงุฑุงุช (Kafka/NATS-ready).
- ุชูููุฏ Clients/Mocks ุขูููุง ูู ุงูุนููุฏ (openapi-typescript ุฃู ูุดุงุจู).

### ุงููุฑุญูุฉ 7 โ ุงููุฑุงูุจุฉ ูุงูุชุดุบูู
- ุชูุญูุฏ ุงูุณุฌูุงุช/ุงูููุงููุณ ุนุจุฑ ุฅุนุฏุงุฏ OTel (ููู config/otel.yaml).
- ูุซููุฉ ุชุดุบูู ููุญูุฏุฉ: `docs/runbook.md` ูุญุฏุซุฉ ุจุนุฏ ุงูููู.
- ุณูุงุณุฉ ุฃุณูุงุก ููุงุนุฏ ุงูุจูุงูุงุช ุชุจูู ููุง ูู (kb.db, observability.db, extended_mind.db, lancedb/) ูุน ุฅููุงููุฉ ูุงุญูุฉ ูุจุงุฏุฆุงุช ุจูุฆูุฉ ุนุจุฑ config.

### ุงููุฑุญูุฉ 8 โ ุญูููุฉ ุงููููุงุก ูุงูููููุฉ
- ุงูุขู ุฌููุน ุงููููุงุก (33) ูุณุฌูููู. ุญุงูุธ ุนูู Registry ูุงุญุฏ (`modules/agents/registry.py` ูุงุญูุงู).
- ูุตู ุงููููุงุก ุงูุชุฌุฑูุจูุฉ ูู `modules/agents/experimental/` ุฅู ูุฒู.
- ุชุญุฏูุซ `AGENTS.md` ูService Catalog ุนูุฏ ุฃู ุชุนุฏูู.

## ุงูุฌุฏูู ุงูุฒููู ุงูููุชุฑุญ (ุฃุณุงุจูุน)
- ุงูุฃุณุจูุน 1: ุฅููุงุก ุงููุฑุญูุฉ 1ุ ุชูููุฐ ุงููุฑุญูุฉ 2ุ ุชููุฆุฉ ui-gateway.
- ุงูุฃุณุจูุน 2: ุงููุฑุญูุฉ 3 + ุทููุงุฑ ุงููุฑุญูุฉ 4 (agents) + ุจุฏุก ุงููุฑุญูุฉ 5 (ุฃููู ุงูุญุฒู).
- ุงูุฃุณุจูุน 3: ุชุนููู ุงููุฑุญูุฉ 4 ูุฏูููู ุซุงููุ ุงุณุชููุงู ุงููุฑุญูุฉ 5.
- ุงูุฃุณุจูุน 4: ุงููุฑุญูุฉ 6 (ุงูุนููุฏ) + ุงููุฑุญูุฉ 7 (ูุฑุงูุจุฉ ูุชุดุบูู) + ุถุจุท ูุซุงุฆู.

## ููุงุท ุญุฐุฑ
- ุดุบูู lint/tests ุจุนุฏ ูู ููุฌุฉ ููู (`poetry run ruff`, `poetry run pytest`, `npm run lint/build --prefix web`).
- ุญุงูุธ ุนูู ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ ูุจู ููู ูููุงุช ูุจูุฑุฉ ุฃู ุชุบููุฑ ุงููุณุงุฑุงุช.
- ูุซูู ุฃู ุฅุนุงุฏุฉ ุชุณููุฉ ุนุจุฑ ADR ูุจุณุท ูุน ุฐูุฑ ุงููุณุงุฑุงุช ุงููุฏููุฉ/ุงูุฌุฏูุฏุฉ.

## ูุณุงุฑ ุงูุชูููุฐ ุงููุชุชุงูู (ูุง ุชุจููู)
1) ุชูุซูู ููุงุฆู: ุญุฏูุซ `docs/service-catalog.md` ู`docs/runbook.md` ุจุงููุณุงุฑุงุช ุงูุฌุฏูุฏุฉ (modules/*ุ ui/webุ ui-gateway) ูุฌุฏูู ููุงุนุฏ ุงูุจูุงูุงุช ูุงูููุงูุฐ.
2) ุชูุธูู ุงูุชูุฑุงุฑุงุช: ุจุนุฏ ูุงูุฐุฉ ุงุณุชูุฑุงุฑุ ุงุญุฐู ูุณุฎ ุงูุฏููููุงุช ุงููุฏููุฉ ุชุญุช `backend/{kb,memory,policies,hdal}` ูุน ุฅุจูุงุก ุงูุดููุงุช ุฃู ุฅุฒุงูุชูุง ููุงุฆูุงู ุนูุฏ ุซุจุงุช ุงูุงุณุชูุฑุงุฏุงุช.
3) ุฅุตุฏุงุฑ ุงูุญุฒู: ุถุจุท ูุดุฑ ุฏุงุฎูู ูู `libs/js/ui-components` ู`libs/python/*` (ุฅุตุฏุงุฑ npm/wheel) ูุฑุจุทูุง ุจู CI/CD.
4) ุงูุนููุฏ ูุงูุฃุญุฏุงุซ: ุงุณุชุฎุฑุงุฌ Schemas ุฅูู `api/schemas/` ุฃู `contracts/api/`ุ ุซู ุชูููุฏ clients/mocks (openapi-typescript ุฃู ูุง ูุนุงุฏููุง).
5) ูุฑุงูุจุฉ ููุญูุฏุฉ: ุฅุถุงูุฉ ุฅุนุฏุงุฏ OTel (`config/otel.yaml`) ูุฑุจุท ุณุฌูุงุช/ููุงููุณ ุฎุฏูุงุช API/UI.
6) ุชูููู ุงูุญูููุฉ: ุชุญุฏูุซ `AGENTS.md` ูRegistry ุจุนุฏ ุฃู ุชุนุฏูู ูุฅุฒุงูุฉ ุงูุดููุงุช ุงููุคูุชุฉ ูููููุงุก ุญูู ุชุณุชูุฑ ุงููุณุงุฑุงุช.
